var EoneoPay=function(){"use strict";var t=[{type:"visaelectron",patterns:/^(4026|417500|4405|4508|4844|4913|4917)/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{type:"maestro",patterns:/^(5018|502|503|56|58|639|6220|67)/,format:/(\d{1,4})/g,length:/^(12|13|14|15|16|17|18|19)/,cvcLength:/^3$/,luhn:!0},{type:"forbrugsforeningen",patterns:/^600/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{type:"dankort",patterns:/^5019/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{type:"visa",patterns:/^4/,format:/(\d{1,4})/g,length:/^(13|16)/,cvcLength:/^3$/,luhn:!0},{type:"mastercard",patterns:/^(51|52|53|54|55|22|23|24|25|26|27)/,format:/(\d{1,4})/g,length:/^(13|16)/,cvcLength:/^3$/,luhn:!0},{type:"amex",patterns:/^(34|37)/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:/^15$/,cvcLength:/^(3|4)/,luhn:!0},{type:"dinersclub",patterns:/^(30|36|38|39)/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:/^14$/,cvcLength:/^3$/,luhn:!0},{type:"discover",patterns:/^(60|64|65|622)/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{type:"unionpay",patterns:/^(62|88)/,format:/(\d{1,4})/g,length:/^(16|17|18|19)/,cvcLength:/^3$/,luhn:!1},{type:"jcb",patterns:/^35/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0}],e="invalid card number",n="invalid card name",r="invalid account name",o="invalid account number",a="expiry.month and expiry.year is required",i="account prefix is required",u="expiry month has to consist of 2 symbols",s="expiry year has to consist of 4 symbols",p="token is required",c="user is not authorized",y="unsuccessful request";function h(t){return{name:"eoneo-exception",message:t}}function d(t,e){var n=t;n instanceof Array&&(n=n.join(", "));var r=h(n);if("function"!=typeof e)return Promise?Promise.reject(r):r;e(r)}return function(){function f(t){if(this.params=t,!t||"object"==typeof t&&!t.token)throw new Error("token is required")}return Object.defineProperty(f.prototype,"token",{get:function(){var t=this.params;return"string"==typeof t?t:t.token},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"url",{get:function(){var t=this.params;return"object"==typeof t&&t.url?t.url:"https://pay.eoneopay.com"},enumerable:!0,configurable:!0}),f.prototype.luhnCheck=function(t){for(var e,n=[0,2,4,6,8,1,3,5,7,9],r=t.length,o=1,a=0;r;)e=parseInt(t.charAt(--r),10),a+=(o^=1)?n[e]:e;return!!a&&a%10==0},f.prototype.sendRequest=function(t){var e;if(XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){throw new Error("current platform does not support XMLHttpRequest")}var n=t.callback,r=this.url+t.endpoint;e.responseType="json",e.open(t.type,r,!0),e.setRequestHeader("Authorization","Basic "+btoa(this.token+":")),e.setRequestHeader("Content-type","application/vnd.eoneopay.v1+json"),e.setRequestHeader("Accept","application/json");var o=function(t,e){var r=h(t);"function"==typeof n?n(r):"function"==typeof e&&e(r)},a=t.data?JSON.stringify(t.data):null,i=function(t,r){e.onerror=function(){o(y,r)},e.onload=function(){var a=String(e.status),i=e.response||{};/^2/.test(a)?("function"==typeof n&&n(null,e.response),"function"==typeof t&&t(e.response)):/401/.test(a)?o(c,r):o(i.message||e.statusText,r)},e.send(a)};if(Promise&&!n)return new Promise(i);i()},f.prototype.cardTypeForNumber=function(t){return void 0===t&&(t=""),this.getCardTypeByNumber(t)},f.prototype.getCardTypeByNumber=function(e){return void 0===e&&(e=""),t.find(function(t){return t.patterns.test(e)})},f.prototype.getCardTypeByName=function(e){return void 0===e&&(e=""),t.find(function(t){return t.type===e})},f.prototype.getPaymentSystem=function(t){var e=this.getCardTypeByNumber(String(t));return e?e.type:""},f.prototype.getCardNameBasedOnNumber=function(t){return this.getPaymentSystem(t)},f.prototype.cardNameForNumber=function(t){return this.getPaymentSystem(t)},f.prototype.validateAccountNumber=function(t){return/^[0-9]{6,9}$/.test(String(t))},f.prototype.validateAccountName=function(t){return/^.{6,100}$/.test(t)},f.prototype.validateCardNumber=function(t){var e=String(t),n=this.getCardTypeByNumber(e);if(!n)return!1;var r=n.length.test(String(e.length)),o=this.luhnCheck(e);return r&&o},f.prototype.tokeniseCard=function(t,e){return this.tokenizeCard(t,e)},f.prototype.tokenizeCard=function(t,r){var o=[];return this.validateCardNumber(t.number)||o.push(e),this.validateAccountName(t.name)||o.push(n),t.expiry?2!==t.expiry.month.length?o.push(u):/^(.{2}|.{4})$/.test(t.expiry.year)||o.push(s):o.push(a),o.length?d(o,r):(t.type="credit_card",this.sendRequest({type:"POST",endpoint:"/tokens",data:t,callback:r}))},f.prototype.tokeniseAccount=function(t,e){return this.tokenizeAccount(t,e)},f.prototype.tokenizeAccount=function(t,e){var n=[];return this.validateAccountNumber(t.number)||n.push(o),this.validateAccountName(t.name)||n.push(r),t.prefix||n.push(i),n.length?d(n,e):(t.country="AU",t.type="bank_account",this.sendRequest({type:"POST",endpoint:"/tokens",data:t,callback:e}))},f.prototype.retrieveToken=function(t,e,n){this.tokeniseCard(t,function(t,r){t?n(t):e(r)})},f.prototype.getTokenInfo=function(t,e){return t?this.sendRequest({type:"GET",endpoint:"/tokens/"+t,callback:e}):d(p,e)},f}()}();
