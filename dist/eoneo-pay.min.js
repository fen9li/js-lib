"use strict";var CARD_TYPES=[{name:"visaelectron",patterns:/^(4026|417500|4405|4508|4844|4913|4917)/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{name:"maestro",patterns:/^(5018|502|503|56|58|639|6220|67)/,format:/(\d{1,4})/g,length:/^(12|13|14|15|16|17|18|19)/,cvcLength:/^3$/,luhn:!0},{name:"forbrugsforeningen",patterns:/^600/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{name:"dankort",patterns:/^5019/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{name:"visa",patterns:/^4/,format:/(\d{1,4})/g,length:/^(13|16)/,cvcLength:/^3$/,luhn:!0},{name:"mastercard",patterns:/^(51|52|53|54|55|22|23|24|25|26|27)/,format:/(\d{1,4})/g,length:/^(13|16)/,cvcLength:/^3$/,luhn:!0},{name:"amex",patterns:/^(34|37)/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:/^15$/,cvcLength:/^(3|4)/,luhn:!0},{name:"dinersclub",patterns:/^(30|36|38|39)/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:/^14$/,cvcLength:/^3$/,luhn:!0},{name:"discover",patterns:/^(60|64|65|622)/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0},{name:"unionpay",patterns:/^(62|88)/,format:/(\d{1,4})/g,length:/^(16|17|18|19)/,cvcLength:/^3$/,luhn:!1},{name:"jcb",patterns:/^35/,format:/(\d{1,4})/g,length:/^16$/,cvcLength:/^3$/,luhn:!0}],EoneoPay=function(){function t(t){if(this.token=t,this.apiUrl="https://pay.eoneopay.com",!t)throw new Error("token is required")}return t.prototype.getCardTypeByNumber=function(t){return void 0===t&&(t=""),CARD_TYPES.find(function(e){return e.patterns.test(t)})},t.prototype.getCardTypeByName=function(t){return void 0===t&&(t=""),CARD_TYPES.find(function(e){return e.name===t})},t.prototype.getPaySystem=function(t){var e=this.getCardTypeByNumber(String(t));return e?e.name:""},t.prototype.validateAccountNumber=function(t){return/^[0-9]{6,9}$/.test(String(t))},t.prototype.validateAccountName=function(t){return/^.{6,100}$/.test(t)},t.prototype.validateCardNumber=function(t){var e=String(t),n=this.getCardTypeByNumber(e);if(!n)return!1;var r=n.length.test(String(e.length)),o=this.luhnCheck(e);return r&&o},t.prototype.luhnCheck=function(t){for(var e,n=[0,2,4,6,8,1,3,5,7,9],r=t.length,o=1,a=0;r;)e=parseInt(t.charAt(--r),10),a+=(o^=1)?n[e]:e;return!!a&&a%10==0},t.prototype.sendRequest=function(t,e,n){var r;if(void 0===t&&(t="POST"),XMLHttpRequest)r=new XMLHttpRequest;else try{r=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){throw new Error("current platform does not support XMLHttpRequest")}return r.open(t,this.apiUrl+e,!0),r.setRequestHeader("Authorization","Basic "+btoa(this.token+":")),r.setRequestHeader("Content-type","application/vnd.eoneopay.v1+json"),r.setRequestHeader("Accept","application/json"),new Promise(function(t,e){r.onload=function(){t({status:r.status,statusText:r.statusText,response:r.response})},r.onerror=function(){var t="unsuccessful request";401===r.status&&(t="user is not authorized"),e({message:t,name:"eoneo-exception"})},r.send(n)})},t.prototype.tokeniseCard=function(t){return t.type="credit_card",this.sendRequest("POST","/tokens",JSON.stringify(t))},t.prototype.tokeniseAccount=function(t){return t.country="AU",t.type="bank_account",this.sendRequest("POST","/tokens",JSON.stringify(t))},t.prototype.getTokenInfo=function(t){return this.sendRequest("GET","/tokens/"+t)},t}();module.exports=EoneoPay;
